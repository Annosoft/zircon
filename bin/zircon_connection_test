#!/usr/bin/env perl

use strict;
use warnings;

use Tk;

sub create_child {
    my ($tag, $name, $local_endpoint, $remote_endpoint) = @_;
    fork == 0 or return;
    exec 'zircon_connection'
        , '-tag'             => $tag
        , '-name'            => $name
        , '-local_endpoint'  => $local_endpoint
        , '-remote_endpoint' => $remote_endpoint
        ;
}

my $id;
my $count = 0;

sub run {
    $count++;
    my $name = $count;
    my $selection_a = "Zircon_${id}_${count}_A";
    my $selection_b = "Zircon_${id}_${count}_B";
    create_child 'A', $name, $selection_a, $selection_b;
    create_child 'B', $name, $selection_b, $selection_a;
    return;
}

my $main_window = MainWindow->new;
$id = $main_window->id;
$main_window->geometry('300x50');
$main_window->title('Zircon: Connection: Test');
$main_window
    ->Button(
    '-text'    => 'Run',
    '-command' => \&run)
    ->pack(
    '-expand' => 1,
    '-fill'   => 'both');

MainLoop();

=head1 AUTHOR

Ana Code B<email> anacode@sanger.ac.uk
